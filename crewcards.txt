<?php
$wpdb->show_errors();

echo $_POST['CrewName'] . '\n';
//Check if a crew was searched for
if (isset($_POST['CrewName'])) {
  $crewName = sanitize_text_field($_POST['CrewName']);
  echo 'in if' . $crewName;
} else {
  $crewName = 'Xin';
}
echo 'out of if' . $crewName;

//$fetchCrew = $wpdb->prepare("SELECT * FROM crew_stats WHERE CharacterDesignName = %s", $CrewName);
//$crew = $wpdb->get_results($fetchCrew);
$fetchCrew = 'SELECT * FROM crew_stats WHERE CharacterDesignName = \'' . $crewName . '\';';
echo $fetchCrew;
$crew = $wpdb->get_results($fetchCrew);

//Check if a crew was graded
if (isset($_POST['Rating'])) {
  $rating = sanitize_text_field($_POST['Rating']);
//  $insertRating = $wpdb->prepare("INSERT INTO crew_input (CharacterDesignName, User, GunnerInput) VALUES(%s, 'rigging', %d) ON DUPLICATE KEY UPDATE GunnerInput=%d", array($crewName, $rating, $rating));
//  $wpdb->query('INSERT INTO crew_input (CharacterDesignName, User, GunnerInput) VALUES($crewName, \'rigging\', $rating) ON DUPLICATE KEY UPDATE GunnerInput=$rating');
}

//Clean up the data to be human readable
//Ability type and power
echo var_dump($array);
switch ($crew[0]->SpecialAbilityType) {
    case 'AddReload':
        $formattedAbility = $crew[0]->SpecialAbilityFinalArgument . '% Rush';
        break;
    case 'DamageToCurrentEnemy':
        $formattedAbility = $crew[0]->SpecialAbilityFinalArgument . 'HP Critical Strike';
        break;
    case 'DamageToRoom':
        $formattedAbility = $crew[0]->SpecialAbilityFinalArgument . 'dmg Ultra Dismantle';
        break;
    case 'DamageToSameRoomCharacters':
        $formattedAbility = $crew[0]->SpecialAbilityFinalArgument . 'HP Poison Gas';
        break;
    case 'DeductReload':
        $formattedAbility = ($crew[0]->SpecialAbilityFinalArgument / 40) . 's System Hack';
        break;
    case 'FireWalk':
        $formattedAbility = ($crew[0]->SpecialAbilityFinalArgument / 40) . 's Blaze Walk';
        break;
    case 'Freeze':
        $formattedAbility = ($crew[0]->SpecialAbilityFinalArgument / 40) . 's Cryo Blast';
        break;
    case 'HealRoomHp':
        $formattedAbility = $crew[0]->SpecialAbilityFinalArgument . 'dmg Urgent Repair';
        break;
    case 'HealSameRoomCharacters':
        $formattedAbility = $crew[0]->SpecialAbilityFinalArgument . 'HP Healing Rain';
        break;
    case 'HealSelfHp':
        $formattedAbility = $crew[0]->SpecialAbilityFinalArgument . 'HP First Aid';
        break;
    case 'SetFire':
        $formattedAbility = ($crew[0]->SpecialAbilityFinalArgument / 40) . 'x Arson';
        break;
    default:
        $formattedAbility = 'None';
}
//Collection
switch ($crew[0]->CollectionDesignId) {
    case '0':
        $formattedCollection = 'None';
        $collectionDescription = 'No effect';
        break;
    case '1':
        $formattedCollection = 'SavySoda';
        $collectionDescription = '';
        break;
    case '2':
        $formattedCollection = 'Sango';
        $collectionDescription = '';
        break;
    case '3':
        $formattedCollection = 'Cats';
        $collectionDescription = '';
        break;
    case '4':
        $formattedCollection = 'Office Worker';
        $collectionDescription = '';
        break;
    case '5':
        $formattedCollection = 'Critters';
        $collectionDescription = 'Small self heal when attacking enemy crew';
        break;
    case '6':
        $formattedCollection = 'Space Pirate';
        $collectionDescription = '';
        break;
    case '7':
        $formattedCollection = 'Federation';
        $collectionDescription = '';
        break;
    case '8':
        $formattedCollection = 'Qtarian';
        $collectionDescription = '';
        break;
    case '9':
        $formattedCollection = 'Constellation';
        $collectionDescription = '';
        break;
    case '13':
        $formattedCollection = 'Gray';
        $collectionDescription = '';
        break;
    case '14':
        $formattedCollection = 'Visiri';
        $collectionDescription = '';
        break;
    case '15':
        $formattedCollection = 'Ardent';
        $collectionDescription = '';
        break;
    case '16':
        $formattedCollection = 'OncePerYear';
        $collectionDescription = '';
        break;
    default:
        $formattedCollection = 'None';
        $collectionDescription = '';
}

//Equipment
$formattedEquipment = 'None';
$equipmentArray = array();

if ($crew[0]->EquipmentMask >= 32) {
  array_push($equipmentArray, 'pet');
  $crew[0]->EquipmentMask -= 32;
}
if ($crew[0]->EquipmentMask >= 16) {
  array_push($equipmentArray, 'accessory');
  $crew[0]->EquipmentMask -= 16;
}
if ($crew[0]->EquipmentMask >= 8) {
  array_push($equipmentArray, 'weapon');
  $crew[0]->EquipmentMask -= 8;
}
if ($crew[0]->EquipmentMask >= 4) {
  array_push($equipmentArray, 'leg');
  $crew[0]->EquipmentMask -= 4;
}
if ($crew[0]->EquipmentMask >= 2) {
  array_push($equipmentArray, 'body');
  $crew[0]->EquipmentMask -= 2;
}
if ($crew[0]->EquipmentMask >= 1) {
  array_push($equipmentArray, 'head');
  $crew[0]->EquipmentMask -= 1;
}
$formattedEquipment = join(', ',$equipmentArray);

?>

<style>
#crewTitle {
  color:purple;
  margin:0;
}
.outercontainer {
  border-color: MidnightBlue;  
  border-style: solid;
  border-width: 4px;
  border-radius: 6px;
  margin: 4px;
  text-align: center;
  word-spacing: 30px;
}
.containerheading {
  text-align: left;
  color:MidnightBlue;
  margin-left: 5px;
  margin-bottom: 10px;
  word-spacing: normal;
}
.statblock {
  vertical-align: middle;
  display: inline-block;
  word-spacing: normal;
}
.statheading {
  margin-bottom: 0px;
}
.tooltip {
  position: relative;
  display: inline-block;
  color:MidnightBlue;
}
.tooltip .tooltiptext {
  visibility: hidden;
  background-color: #555;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px 0;
  position: absolute;
  z-index: 1;
  bottom: 125%;
  left: 50%;
  margin-left: -60px;
  opacity: 0;
  transition: opacity 0.3s;
}
.tooltip .tooltiptext::after {
  content: "";
  position: absolute;
  top: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: #555 transparent transparent transparent;
}
.tooltip:hover .tooltiptext {
  visibility: visible;
  opacity: 1;
}
</style>

<div>
  <p>The crew cards are on this page can be used to review the stats of crew, what roles they can perform on your ship, and what crew they can prestige into. Crew role ratings are among ALL crew, so a crew marked "Best as: gunner" is one of the best gunner crews in the game.</p>
  <form action="" method="post">
    <label for="crewName">Crew name:</label>
    <input type="text" style="width: 150px;margin-right: 10px" id="CrewName" name="CrewName">
    <input type="submit" value="Submit"><br /><br />
  </form>
</div>

<div>
  <form action="" method="post">
    <input type="radio" id="zero" name="rating" value="0">
    <label for="zero">0</label><br>
    <input type="radio" id="one" name="rating" value="1">
    <label for="one">1</label><br>
    <input type="radio" id="two" name="rating" value="2">
    <label for="two">2</label><br>
    <input type="radio" id="three" name="rating" value="3">
    <label for="three">3</label><br>
    <input type="radio" id="four" name="rating" value="4">
    <label for="four">4</label><br>
    <input type="submit" value="Rate"><br /><br />
  </form>
</div>

<div style="border-style:solid;border-width:4px;max-width:650px">
<!--  <img src="https://pixelperfectguide.com/wp-content/uploads/2020/02/ardenttemplar.png" alt="Ardent Templar" style="margin-right: 10px;margin-bottom: 10px;float: left;max-width: 20%;height: auto;">
  -->
  <! --one star, common "white"
  two star, "LimeGreen"
  three star unique "Navy"
  four star epic "Purple"
  five star hero "OrangeRed"
  one shield special "Black"
  wings legendary "DarkGoldenRod" ––>

  <h1 id="crewTitle"><strong><? echo $crew[0]->CharacterDesignName; ?></strong></h1>
  <img src="https://pixelperfectguide.com/wp-content/uploads/2020/02/gem.png" alt="gem" style="float: left;width:20px;height:20px;margin-right:10px;">
  <img src="https://pixelperfectguide.com/wp-content/uploads/2020/02/gem.png" alt="gem" style="float: left;width:20px;height:20px;margin-right:10px;">
  <img src="https://pixelperfectguide.com/wp-content/uploads/2020/02/gem.png" alt="gem" style="float: left;width:20px;height:20px;margin-right:10px;">
  <img src="https://pixelperfectguide.com/wp-content/uploads/2020/02/gem.png" alt="gem" style="float: left;width:20px;height:20px;margin-right:10px;">
  <br />
  <h5><? echo $crew[0]->CharacterDesignDescription; ?></h5>
  <p style="clear:both;margin-top:0px;margin-bottom:0px"> </p>

  <div class="outercontainer">
    <h4 class="containerheading"><strong>Core Stats<br /></strong></h4>
    <div class="statblock">
      <h5 class="statheading"><strong>HP</strong></h5>
      <h5><? echo $crew[0]->FinalHp; ?></h5>
    </div>
    <div class="statblock">
      <h5 class="statheading"><strong>Attack</strong></h5>
      <h5><? echo $crew[0]->FinalAttack; ?></h5>
    </div>
    <div class="statblock">
      <h5 class="statheading"><strong>Repair</strong></h5>
      <h5><? echo $crew[0]->FinalRepair; ?></h5>
    </div>
    <div class="statblock">
      <h5 class="statheading"><strong>Ability</strong></h5>
      <h5><? echo $formattedAbility; ?></h5>
    </div>
    <div class="statblock">
      <button id="moreStatsButton" style="color: white;background-color: MidnightBlue;" onclick="moreStats()">More Stats</button>
    </div>
  </div>
<!--  <div class="outercontainer" id="roomStats" style="display: none"> -->
  <div class="outercontainer" id="roomStats">
    <h4 class="containerheading"><b>Room Stats<br /></b></h4>
    <div class="statblock">
      <h5 class="statheading"><strong>Weapon</strong></h5>
      <h5><? echo $crew[0]->FinalWeapon; ?></h5>
    </div>
    <div class="statblock">
      <h5 class="statheading"><strong>Science</strong></h5>
      <h5><? echo $crew[0]->FinalScience; ?></h5>
    </div>
    <div class="statblock">
      <h5 class="statheading"><strong>Pilot</strong></h5>
      <h5><? echo $crew[0]->FinalPilot; ?></h5>
    </div>
    <div class="statblock">
      <h5 class="statheading"><strong>Engine</strong></h5>
      <h5><? echo $crew[0]->FinalEngine; ?></h5>
    </div>
  </div>
<!--  <div class="outercontainer" id="utilityStats" style="display: none"> -->
  <div class="outercontainer" id="utilityStats">
    <h4 class="containerheading"><strong>Utility Stats<br /></strong></h4>
    <div class="statblock">
      <h5 class="statheading"><strong>Walk/Run Speed</strong></h5>
      <h5><? echo $crew[0]->WalkingSpeed; echo '/'; echo $crew[0]->RunSpeed;?></h5>
    </div>
    <div class="statblock">
      <h5 class="statheading"><strong>Fire Resist</strong></h5>
      <h5><? echo $crew[0]->FireResistance; ?></h5>
    </div>
    <div class="statblock">
      <h5 class="statheading"><strong>Training Points</strong></h5>
      <h5><? echo $crew[0]->TrainingCapacity; ?></h5>
    </div>
    <div class="statblock">
      <h5 class="statheading"><strong>Collection</strong></h5>
      <h5><? echo $formattedCollection; ?><sup class="tooltip">info<span class="tooltiptext"><? echo $collectionDescription; ?></span></sup></h5>
    </div>
    <div class="statblock">
      <h5 class="statheading"><strong>Equipment</strong></h5>
      <h5><? echo $formattedEquipment; ?></h5>
    </div>
  </div>
  <div style="border-style:solid;border-color:Purple;border-width:4px;border-radius:6px;margin:4px">
    <h4 class="containerheading" style="color:Purple;"><strong>Roles</strong></h4>
    <h5 style="margin-left: 5px;margin-bottom: 5px;"><strong>Best as:</strong> TO BE COMPLETED </h5>
    <h5 style="margin-left: 5px;margin-bottom: 5px;"><strong>Good as:</strong> TO BE COMPLETED </h5>
    <h5 style="margin-left: 5px;margin-bottom: 5px;"><strong>Average as:</strong> TO BE COMPLETED </h5>
  </div>
  <div style="border-style:solid;border-color:DarkGoldenrod;border-width:4px;border-radius:6px;margin:4px">
    <h4 class="containerheading" style="color: DarkGoldenrod;"><b>Prestige Options</b></h4>
    <h5 style="margin-left: 5px;"><u> TO BE COMPLETED </u>, <u>Rocky</u>, <u>Jaiden</u>, <u>Ryzen</u>, <u>Admiral Serena</u>, <u>Sagita</u>, <u>Leon Mars</u>, <u>Ichigo</u>, <u>Turkey Hero</u></h5> 
  </div>
</div>

<script>
function moreStats() {
  var roomStats = document.getElementById("roomStats");
  var utilityStats = document.getElementById("utilityStats");
  var moreStatsButton = document.getElementById("moreStatsButton");
  if (roomStats.style.display === "none") {
    roomStats.style.display = "block";
    utilityStats.style.display = "block";
    moreStatsButton.innerHTML = "Fewer Stats";
  } else {
    roomStats.style.display = "none";
    utilityStats.style.display = "none";
    moreStatsButton.innerHTML = "More Stats";
  }
}
</script>